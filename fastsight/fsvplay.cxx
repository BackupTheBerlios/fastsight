// generated by Fast Light User Interface Designer (fluid) version 1.0106

#include "fsvplay.h"
#include "j2kcodec.h"
#include <FL/Fl_File_Chooser.H>
#include <string.h>
static int playing = 0;
static unsigned int nframes = 0;
static char *filename;
static FILE *fp, *idxf;

Fl_Double_Window *mainwnd=(Fl_Double_Window *)0;

Fl_Box *videoarea=(Fl_Box *)0;

static void cb_(Fl_Button*, void*) {
  playing = 1;
Fl::repeat_timeout(0.1, show_video);
}

#include <FL/Fl_Image.H>
static unsigned char idata_play[] =
"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0O\0\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0g\0\0\0\377\0\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\0\0\0\377\0\0\0""3\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0g\0\0\0\377rqp\377\0\0\0\377\0\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377{{z\377lkj\
\377\0\0\0\377\0\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\177~}\377\231\231\226\377}|{\377\0\0\0\377\0\
\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\
\0\377\202\201\200\377\235\234\232\377\260\257\254\377\220\217\215\377\0\0\0\
\377\0\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\
\377\206\205\203\377\241\240\236\377\264\263\261\377\266\264\262\377\245\244\
\241\377\0\0\0\377\0\0\0""3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\
\0\0\0\377\211\210\206\377\245\244\241\377\271\267\264\377\272\271\266\377\
\274\272\267\377\303\302\277\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\214\213\211\377\251\250\245\377\275\274\
\271\377\305\303\300\377\320\316\314\377\0\0\0\377\377\377\377\377\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\217\216\214\377\265\263\
\261\377\307\306\303\377\322\321\316\377\0\0\0\377\377\377\377\377\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\235\234\232\377\
\271\266\264\377\330\327\325\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\241\237\235\377\
\307\306\304\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\247\246\243\377\0\0\0\377\
\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0g\0\0\0\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0r\0\0\
\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""3\377\377\377\377\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";
static Fl_RGB_Image image_play(idata_play, 24, 24, 4, 0);

static void cb_1(Fl_Button*, void*) {
  playing = 0;
}

static unsigned char idata_pause[] =
"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0!\0\0\0""0\0\0\0""0\0\0\
\0""5\0\0\0=\0\0\0!\0\0\0!\0\0\0""0\0\0\0""0\0\0\0""5\0\0\0=\0\0\0!\377\377\
\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0""2\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\
\377\377\377\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\377\377\
\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0""4\0\0\0\377ssr\377\204\204\203\377\210\210\207\
\377\0\0\0\377\377\377\377\377\0\0\0\377ssr\377\204\204\203\377\210\210\207\
\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""4\0\0\0\377~~}\377\250\247\
\246\377\244\244\243\377\0\0\0\377\377\377\377\377\0\0\0\377~~}\377\250\247\
\246\377\244\244\243\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""4\0\0\0\
\377~~}\377\246\245\244\377\265\264\263\377\0\0\0\377\377\377\377\377\0\0\0\
\377~~}\377\246\245\244\377\265\264\263\377\0\0\0\377\377\377\377\377\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0""2\0\0\0\377\205\204\203\377\252\251\247\377\300\277\276\377\0\0\0\
\377\377\377\377\377\0\0\0\377\205\204\203\377\252\251\247\377\300\277\276\
\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""2\0\0\0\377\221\220\216\377\
\257\256\254\377\312\312\310\377\0\0\0\377\377\377\377\377\0\0\0\377\221\220\
\216\377\257\256\254\377\312\312\310\377\0\0\0\377\377\377\377\377\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0""2\0\0\0\377\221\220\216\377\257\256\254\377\312\312\310\377\0\0\0\
\377\377\377\377\377\0\0\0\377\221\220\216\377\257\256\254\377\312\312\310\
\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""2\0\0\0\377\221\220\216\377\
\257\256\254\377\312\312\310\377\0\0\0\377\377\377\377\377\0\0\0\377\221\220\
\216\377\257\256\254\377\312\312\310\377\0\0\0\377\377\377\377\377\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0""0\0\0\0\377\246\245\242\377\273\272\267\377\324\323\322\377\0\0\0\
\377\377\377\377\377\0\0\0\377\246\245\242\377\273\272\267\377\324\323\322\
\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""0\0\0\0\377\246\245\242\377\
\273\272\267\377\324\323\322\377\0\0\0\377\377\377\377\377\0\0\0\377\246\245\
\242\377\273\272\267\377\324\323\322\377\0\0\0\377\377\377\377\377\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0""0\0\0\0\377\256\255\251\377\277\275\272\377\327\325\323\377\0\0\0\
\377\377\377\377\377\0\0\0\377\256\255\251\377\277\275\272\377\327\325\323\
\377\0\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0,\0\0\0\377\262\260\255\377\
\303\301\276\377\331\330\326\377\0\0\0\377\377\377\377\377\0\0\0\377\262\260\
\255\377\303\301\276\377\331\330\326\377\0\0\0\377\377\377\377\377\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0-\0\0\0\377\265\263\260\377\321\317\314\377\336\335\333\377\0\0\0\377\
\377\377\377\377\0\0\0\377\265\263\260\377\321\317\314\377\336\335\333\377\0\
\0\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0-\0\0\0\377\0\0\0\377\0\0\0\377\0\0\
\0\377\0\0\0\377\377\377\377\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\0\377\0\0\
\0\377\377\377\377\377\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\21\377\377\377\377\377\377\377\377\
\377\377\377\377\377\377\377\377\377\377\377\377\363\363\363\237\377\377\377\
\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\377\
\377\230\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";
static Fl_RGB_Image image_pause(idata_pause, 24, 24, 4, 0);

Fl_Slider *position=(Fl_Slider *)0;

static void cb_position(Fl_Slider*, void*) {
  unsigned int pos;
fseek(idxf, ((unsigned int)position->value())*4, SEEK_SET);
fread(&pos, 1, 4, idxf);
fseek(fp, pos, SEEK_SET);
if(!playing)
  show_video(0);
}

Fl_Double_Window* make_main_wnd() {
  Fl_Double_Window* w;
  { Fl_Double_Window* o = mainwnd = new Fl_Double_Window(340, 300, "fastsight video player");
    w = o;
    o->color(FL_LIGHT2);
    { Fl_Box* o = videoarea = new Fl_Box(4, 45, 330, 250);
      o->box(FL_EMBOSSED_BOX);
      o->color(FL_BACKGROUND2_COLOR);
    }
    { Fl_Button* o = new Fl_Button(10, 5, 35, 35);
      o->box(FL_PLASTIC_THIN_UP_BOX);
      o->color(FL_LIGHT2);
      o->image(image_play);
      o->callback((Fl_Callback*)cb_);
    }
    { Fl_Button* o = new Fl_Button(50, 5, 35, 35);
      o->box(FL_PLASTIC_THIN_UP_BOX);
      o->color(FL_LIGHT2);
      o->image(image_pause);
      o->callback((Fl_Callback*)cb_1);
    }
    { Fl_Slider* o = position = new Fl_Slider(90, 10, 245, 25);
      o->type(5);
      o->box(FL_PLASTIC_THIN_DOWN_BOX);
      o->callback((Fl_Callback*)cb_position);
    }
    o->end();
  }
  return w;
}

void show_video(void*) {
  unsigned int len;
unsigned char *buf, *rgbimg;
if(fread(&len, 1, 4, fp) != 4)
{
  playing = 0;
  return;
}
buf = (unsigned char *)malloc(len);
if(fread(buf, 1, len, fp) != len)
{
  playing = 0;
  return;
}
j2kcodec_decode(buf, len, &rgbimg);
free(buf);
Fl_RGB_Image *flimg = new Fl_RGB_Image((const uchar *)rgbimg, 320, 240, 3);
videoarea->image(flimg);
videoarea->redraw();
position->value(position->value()+1);
if(playing)
    Fl::repeat_timeout(0.1, show_video);
}

void make_index() {
  unsigned int len, pos;
idxf = fopen(filename, "wb");
for(;;)
{
  pos = ftell(fp);
  nframes++;
  fwrite(&pos, 1, 4, idxf);
  if(fread(&len, 1, 4, fp) != 4)
    break;
  if(fseek(fp, len, SEEK_CUR) < 0)
    break;
}
fclose(idxf);
idxf = fopen(filename, "rb");
fseek(fp, 0, SEEK_SET);
}

int main(int argc, char **argv) {
  if(argc == 2)
  filename = argv[1];
else if(!(filename = fl_file_chooser("Select video", "*.fsv", NULL)))
  return 0;
if(!(fp = fopen(filename, "rb")))
  return 0;
filename[strlen(filename)-1] = 'i';
if((idxf = fopen(filename, "rb")))
{
  fseek(idxf, 0, SEEK_END);
  nframes = ftell(idxf) / 4;
  fseek(idxf, 0, SEEK_SET);
} else {
  make_index();
}
j2kcodec_decoder_init();
make_main_wnd()->show();
position->range(0, nframes - 1);
Fl::add_timeout(0.1, show_video);
return Fl::run();
}
